# OppsEra Load Test Report

**Profile:** {{PROFILE}}
**Environment:** {{ENVIRONMENT}}
**Date:** {{DATE}}
**Duration:** {{DURATION}}
**k6 Exit Code:** {{EXIT_CODE}}

---

## Executive Summary

| Metric | Target | Actual | Status |
|--------|--------|--------|--------|
| POS Item Lookup P95 | <100ms | {{POS_ITEM_P95}}ms | {{POS_ITEM_STATUS}} |
| POS Order Creation P95 | <200ms | {{POS_ORDER_P95}}ms | {{POS_ORDER_STATUS}} |
| Order History P95 | <150ms | {{ORDER_HIST_P95}}ms | {{ORDER_HIST_STATUS}} |
| Customer Search P95 | <200ms | {{CUST_SEARCH_P95}}ms | {{CUST_SEARCH_STATUS}} |
| HTTP Error Rate | <1% | {{ERROR_RATE}}% | {{ERROR_STATUS}} |
| Tenant Isolation | 0 violations | {{ISOLATION_VIOLATIONS}} | {{ISOLATION_STATUS}} |

**Overall Result: {{OVERALL_RESULT}}**

---

## Scenario Results

### 1. POS Checkout
- VUs: {{POS_VUS}}
- Iterations: {{POS_ITERATIONS}}
- P95 Latency: {{POS_P95}}ms
- P99 Latency: {{POS_P99}}ms
- Error Rate: {{POS_ERROR_RATE}}%

### 2. Lunch Rush
- Peak VUs: {{RUSH_VUS}}
- Duration: {{RUSH_DURATION}}
- P95 Latency: {{RUSH_P95}}ms
- Max Concurrent Orders: {{RUSH_MAX_CONCURRENT}}

### 3. Report Storm (if run)
- POS P95 during reports: {{REPORT_POS_P95}}ms
- POS P95 degradation: {{REPORT_DEGRADATION}}%

### 4. Noisy Neighbor (if run)
- Large tenant P95: {{NOISY_LARGE_P95}}ms
- Small tenant P95: {{NOISY_SMALL_P95}}ms
- Small tenant degradation: {{NOISY_DEGRADATION}}%

### 5. Soak Test (if run)
- Duration: {{SOAK_DURATION}}
- First 30min P95: {{SOAK_FIRST_P95}}ms
- Last 30min P95: {{SOAK_LAST_P95}}ms
- Degradation: {{SOAK_DEGRADATION}}%
- Memory trend: {{SOAK_MEMORY_TREND}}

### 6. RLS Isolation Gate
- Read violations: {{RLS_READ_VIOLATIONS}}
- Write violations: {{RLS_WRITE_VIOLATIONS}}
- Context bleed violations: {{RLS_BLEED_VIOLATIONS}}
- **Result: {{RLS_RESULT}}**

---

## Cold Start Analysis (Serverless)

| Metric | Value |
|--------|-------|
| Cold start count | {{COLD_COUNT}} |
| Cold start rate | {{COLD_RATE}}% |
| Cold start P95 | {{COLD_P95}}ms |
| Warm P95 | {{WARM_P95}}ms |
| Cold/Warm ratio | {{COLD_WARM_RATIO}}x |

---

## Database Performance

### Top 5 Queries by Total Time

| Query | Calls | Avg (ms) | Max (ms) | Cache Hit % |
|-------|-------|----------|----------|-------------|
| {{Q1_QUERY}} | {{Q1_CALLS}} | {{Q1_AVG}} | {{Q1_MAX}} | {{Q1_CACHE}} |
| {{Q2_QUERY}} | {{Q2_CALLS}} | {{Q2_AVG}} | {{Q2_MAX}} | {{Q2_CACHE}} |
| {{Q3_QUERY}} | {{Q3_CALLS}} | {{Q3_AVG}} | {{Q3_MAX}} | {{Q3_CACHE}} |
| {{Q4_QUERY}} | {{Q4_CALLS}} | {{Q4_AVG}} | {{Q4_MAX}} | {{Q4_CACHE}} |
| {{Q5_QUERY}} | {{Q5_CALLS}} | {{Q5_AVG}} | {{Q5_MAX}} | {{Q5_CACHE}} |

### Cache Hit Ratios

| Cache Type | Hit % |
|------------|-------|
| Heap (table data) | {{HEAP_CACHE}}% |
| Index | {{INDEX_CACHE}}% |

### Sequential Scans (Potential Missing Indexes)

| Table | Seq Scans | Index Scans | Index Usage % |
|-------|-----------|-------------|---------------|
| {{SEQ1_TABLE}} | {{SEQ1_SEQ}} | {{SEQ1_IDX}} | {{SEQ1_PCT}}% |
| {{SEQ2_TABLE}} | {{SEQ2_SEQ}} | {{SEQ2_IDX}} | {{SEQ2_PCT}}% |

---

## Connection Pool

| Metric | Value |
|--------|-------|
| Max concurrent connections | {{MAX_CONNECTIONS}} |
| Connection errors | {{CONN_ERRORS}} |
| Pool exhaustion events | {{POOL_EXHAUSTION}} |

---

## Breaking Point Card

| Metric | Value |
|--------|-------|
| Max sustainable VUs | {{MAX_VUS}} |
| Breaking VU count | {{BREAKING_VUS}} |
| First error at VU | {{FIRST_ERROR_VU}} |
| Bottleneck | {{BOTTLENECK}} |

---

## Capacity Planning

### Per-Location Formula

```
Concurrent POS terminals × {{TXN_FACTOR}} = required VU capacity
Required VU capacity × {{SAFETY_MARGIN}} = provisioned capacity
```

### Growth Trajectory

| Stage | Tenants | Locations | Peak VUs | DB Connections | Infra |
|-------|---------|-----------|----------|----------------|-------|
| Stage 1 | 1-50 | 1-100 | {{S1_VUS}} | {{S1_CONNS}} | Vercel Pro |
| Stage 2 | 50-500 | 100-1000 | {{S2_VUS}} | {{S2_CONNS}} | Vercel + VPS |
| Stage 3 | 500-2000 | 1000-5000 | {{S3_VUS}} | {{S3_CONNS}} | Docker Compose |
| Stage 4 | 2000-4000+ | 5000+ | {{S4_VUS}} | {{S4_CONNS}} | K8s |

### Migration Decision Matrix

| Signal | Current | Threshold | Action |
|--------|---------|-----------|--------|
| P95 latency | {{CURRENT_P95}}ms | >200ms sustained | Consider VPS migration |
| Connection pool usage | {{POOL_USAGE}}% | >80% | Increase pool / add read replica |
| Cold start rate | {{COLD_RATE}}% | >15% | Enable Vercel warm functions |
| Error rate | {{ERROR_RATE}}% | >1% | Investigate + scale |

---

## Recommendations

1. {{RECOMMENDATION_1}}
2. {{RECOMMENDATION_2}}
3. {{RECOMMENDATION_3}}

---

*Generated by OppsEra Load Test Suite — {{DATE}}*
